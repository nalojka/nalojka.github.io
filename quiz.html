<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ö–≤–∏–∑ –ø–æ –æ–±–ª–∞—Å—Ç—è–º</title>
  <!-- –î–æ–±–∞–≤–ª—è–µ–º Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg-light: #f4f4f9;
      --bg-dark: #0f1720;
      --text-light: #111827;
      --text-dark: #f1f5f9;
      --card-light: #ffffff;
      --card-dark: #111318;
      --accent: #0d6efd;
      --accent-2: #66a3ff;
      --muted-light: #6c757d;
      --muted-dark: #9aa4b2;
      --success: #16a34a;
      --danger: #dc2626;
      --transition-fast: 0.25s;
      --transition-med: 0.4s;
      
      /* –¶–≤–µ—Ç–∞ –¥–ª—è –∏–∫–æ–Ω–æ–∫ —Ç–µ–º—ã */
      --sun-color: #f59e0b;
      --moon-color: #94a3b8;
    }

    /* Base */
    html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;}
    body{
      display:flex;align-items:center;justify-content:center;
      background:var(--bg-light);
      color:var(--text-light);
      transition: background var(--transition-med), color var(--transition-med);
      min-height:100vh;
      padding:20px;
    }
    body.dark{
      background:var(--bg-dark);
      color:var(--text-dark);
    }

    .card{
      width:100%; max-width:900px;
      background:var(--card-light);
      border-radius:14px;
      padding:22px;
      box-shadow:0 10px 30px rgba(2,6,23,0.08);
      position:relative;
      transition: background var(--transition-med), box-shadow var(--transition-med), transform var(--transition-fast);
    }
    body.dark .card{ background:var(--card-dark); box-shadow:0 6px 18px rgba(0,0,0,0.6); }

    h1{ margin:0 0 6px 0; font-size:22px; }
    p.lead{ margin:0 0 18px 0; color: #6b7280; }
    body.dark p.lead{ color: var(--muted-dark); }

    /* Theme toggle - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    .theme-toggle{
      position:absolute; right:18px; top:18px;
      background:transparent;border:none;color:inherit;font-size:20px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      padding:8px;border-radius:10px; transition: transform .35s ease;
      width:44px; height:44px;
    }
    .theme-toggle .icon{ 
      display:inline-block; 
      transform-origin:center; 
      transition: transform .45s ease, color var(--transition-med);
      color: var(--sun-color);
    }
    body.dark .theme-toggle .icon {
      color: var(--moon-color);
    }
    .theme-toggle:active{ transform: scale(0.98); }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è motion blur –ø—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏ */
    .theme-toggle.rotating .icon {
      animation: rotateWithBlur 0.8s ease-in-out;
    }
    
    @keyframes rotateWithBlur {
      0% {
        transform: rotate(0deg);
        filter: blur(0px);
      }
      50% {
        transform: rotate(180deg);
        filter: blur(2px);
      }
      100% {
        transform: rotate(360deg);
        filter: blur(0px);
      }
    }

    /* layout */
    .row{ display:flex; gap:14px; align-items:center; margin-bottom:14px; flex-wrap:wrap; }
    .col{ flex:1; min-width:160px; }

    input[type="text"], select{
      width:100%; padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb;
      font-size:15px; outline: none; transition: box-shadow .15s;
    }
    input[type="text"]:focus, select:focus{ box-shadow:0 6px 20px rgba(13,110,253,0.08); border-color:var(--accent); }

    button.btn{
      background:var(--accent); color:#fff; padding:10px 14px;border-radius:10px;border:none; cursor:pointer;
      font-weight:600; transition: transform .12s, background .2s;
    }
    button.btn:hover{ transform: translateY(-2px); background:var(--accent-2); }

    button.ghost{
      background:transparent;border:1px solid var(--accent); color:var(--accent); padding:9px 12px;border-radius:10px;
    }
    button.ghost:hover{ background:var(--accent); color:#fff; }

    /* Start-screen areas list */
    .areas-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin:12px 0 20px 0; }
    .area-card{
      background: #f8fafc; padding:10px 12px; border-radius:10px; cursor:pointer; text-align:center; border:1px solid transparent;
      transition: transform .18s, border-color .18s, background .18s;
      user-select:none;
    }
    body.dark .area-card{ background:#16181a; }
    .area-card:hover{ transform:translateY(-6px); border-color: rgba(13,110,253,0.18); }
    .area-card.active{ border-color:var(--accent); box-shadow:0 6px 18px rgba(13,110,253,0.06); background: linear-gradient(180deg, rgba(13,110,253,0.05), transparent); }

    /* quiz */
    .progress{ font-size:14px; opacity:0.85; margin-bottom:8px; display:flex;justify-content:space-between; gap:12px; align-items:center;}
    .question{ font-size:18px; margin:12px 0 8px 0; }
    .options{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:8px; }
    @media(min-width:700px){ .options{ grid-template-columns: 1fr 1fr; } }
    .option{
      background:#f1f5f9; padding:12px;border-radius:10px; cursor:pointer; transition: transform .12s, background .15s, box-shadow .15s;
      border:1px solid transparent;
    }
    body.dark .option{ background:#141618; }
    .option:hover{ transform: translateY(-4px); box-shadow:0 8px 24px rgba(2,6,23,0.06); }
    .option.correct{ background:#dcfce7 !important; border-color: rgba(16,185,129,0.18); color:#064e3b; }
    .option.wrong{ background:#ffe4e6 !important; border-color: rgba(220,38,38,0.12); color:#6b021f; opacity:0.95; }

    .auto-next-timer{ height:6px; background:#e9eef7; border-radius:999px; overflow:hidden; margin-top:12px; }
    body.dark .auto-next-timer{ background:#22262a; }
    .auto-next-progress{ height:100%; background:var(--accent); width:0%; transition: width 0.05s linear; }

    /* result & leaders */
    .result-center{ text-align:center; }
    .score-big{ font-size:34px; font-weight:800; margin:8px 0; }
    table{ width:100%; border-collapse:collapse; margin-top:12px; }
    th,td{ padding:10px; text-align:left; border-bottom:1px solid #e6e9ef; }
    body.dark th, body.dark td{ border-color:#22262a; }

    footer{ margin-top:14px; font-size:13px; color: #6b7280; text-align:center; }
    body.dark footer{ color:var(--muted-dark); }

    .hidden{ display:none !important; }

    /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    .input-row {
      display: flex;
      gap: 14px;
      align-items: center;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    
    .input-group {
      display: flex;
      gap: 14px;
      align-items: center;
      flex: 1;
    }
    
    .name-input {
      flex: 1;
      min-width: 200px;
    }
    
    .leaders-btn-container {
      margin-left: auto;
    }

  </style>
</head>
<body>
  <div class="card" id="app">
    <button class="theme-toggle" id="theme-toggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
      <span class="icon" id="theme-icon">
        <i class="fa-solid fa-sun"></i>
      </span>
    </button>

    <h1 id="page-title">–ö–≤–∏–∑ –ø–æ –æ–±–ª–∞—Å—Ç—è–º</h1>
    <p class="lead">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –∫–≤–∏–∑. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥.</p>

    <!-- START SCREEN -->
    <div id="start-screen">
      <div class="input-row">
        <div class="input-group">
          <div class="name-input">
            <input id="player" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è..." />
          </div>
          <div style="min-width:140px;">
            <button id="start-btn" class="btn">–ù–∞—á–∞—Ç—å</button>
          </div>
        </div>
        <div class="leaders-btn-container" style="min-width:140px;">
          <button id="view-leaders" class="ghost">–õ–∏–¥–µ—Ä—ã</button>
        </div>
      </div>

      <div>
        <label style="display:block;margin-bottom:8px;font-weight:600;">–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å:</label>
        <div class="areas-grid" id="areasGrid"></div>
      </div>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="hidden">
      <div class="progress">
        <div id="progress-text">–í–æ–ø—Ä–æ—Å 1/10</div>
        <div id="region-label" style="opacity:0.85;font-weight:600;"></div>
      </div>

      <div class="question" id="question-text">–í–æ–ø—Ä–æ—Å</div>
      <div class="options" id="options"></div>

      <div class="auto-next-timer" aria-hidden="true">
        <div class="auto-next-progress" id="auto-next-progress"></div>
      </div>

      <div style="display:flex; gap:10px; margin-top:14px;">
        <button id="skip-btn" class="ghost">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
        <button id="end-btn" class="ghost">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
      </div>
    </div>

    <!-- RESULT -->
    <div id="result-screen" class="hidden">
      <div class="result-center">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <div class="score-big" id="final-score">0 / 100</div>
        <div id="time-result" style="opacity:0.85;">–í—Ä–µ–º—è: 0 —Å–µ–∫</div>
        <p id="result-text"></p>
        <p id="saving-text" style="font-style:italic; opacity:0.8;"></p>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
          <button id="play-again" class="ghost">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
          <button id="view-leaders-2" class="ghost">–õ–∏–¥–µ—Ä—ã</button>
        </div>
      </div>
    </div>

    <!-- LEADERS -->
    <div id="leaders-screen" class="hidden">
      <h2>–õ–∏–¥–µ—Ä—ã ‚Äî <span id="leaders-region-name">‚Äî</span></h2>
      <table aria-live="polite">
        <thead>
          <tr><th>#</th><th>–ò–º—è</th><th>–û—á–∫–∏</th><th>–í—Ä–µ–º—è</th></tr>
        </thead>
        <tbody id="leaders-body">
        </tbody>
      </table>
      <div style="display:flex; gap:10px; margin-top:12px;">
        <button id="back-home" class="ghost">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        <button id="refresh-leaders" class="ghost">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
    </div>

    <footer id="footer-note">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±–ª–∞—á–Ω–æ–π –±–∞–∑–µ </footer>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    /***** Supabase config (—Ç–≤–æ–π –æ—Ä–∏–≥–∏–Ω–∞–ª) *****/
    const SUPABASE_URL = 'https://xlrmxinwpwjjurltvoms.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhscm14aW53cHdqanVybHR2b21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODY3NjYsImV4cCI6MjA3ODM2Mjc2Nn0.1dUPUXBfmN3cMTkAQVHWgXdhU74hJ6U96v1M_OSoZyI';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    /***** –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–Ω–µ –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–µ) *****/
    const ORIGINAL_QUESTIONS_BY_REGION = {
      "–î–æ–Ω–µ—Ü–∫–∞—è –ù–∞—Ä–æ–¥–Ω–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞": [
        { q: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä –î–ù–†?", options: ["–î–æ–Ω–µ—Ü–∫","–õ—É–≥–∞–Ω—Å–∫","–ì–æ—Ä–ª–æ–≤–∫–∞","–ú–∞–∫–µ–µ–≤–∫–∞"], answer: 0 },
        { q: "–ö–∞–∫–∞—è —Ä–µ–∫–∞ –∫—Ä—É–ø–Ω–µ–π—à–∞—è –≤ —Ä–µ–≥–∏–æ–Ω–µ?", options: ["–°–µ–≤–µ—Ä—Å–∫–∏–π –î–æ–Ω–µ—Ü","–î–æ–Ω","–î–Ω–µ–ø—Ä","–ö–∞–ª—å–º–∏—É—Å"], answer: 0 },
        { q: "–û—Å–Ω–æ–≤–Ω–∞—è –æ—Ç—Ä–∞—Å–ª—å —ç–∫–æ–Ω–æ–º–∏–∫–∏ –î–ù–†?", options: ["–£–≥–ª–µ–¥–æ–±—ã—á–∞","–¢—É—Ä–∏–∑–º","–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ","IT"], answer: 0 },
        { q: "–ö–∞–∫–æ–π –≥–æ—Ä–æ–¥ –∏–∑–≤–µ—Å—Ç–µ–Ω –º–µ—Ç–∞–ª–ª—É—Ä–≥–∏–µ–π?", options: ["–ú–∞–∫–µ–µ–≤–∫–∞","–Ø—Å–∏–Ω–æ–≤–∞—Ç–∞—è","–ì–æ—Ä–ª–æ–≤–∫–∞","–ú–∞—Ä–∏—É–ø–æ–ª—å"], answer: 0 },
        { q: "–§—É—Ç–±–æ–ª—å–Ω—ã–π –∫–ª—É–± –∏–∑ –î–æ–Ω–µ—Ü–∫–∞?", options: ["–®–∞—Ö—Ç—ë—Ä","–î–∏–Ω–∞–º–æ","–ó–∞—Ä—è","–ú–µ—Ç–∞–ª–ª–∏—Å—Ç"], answer: 0 },
        { q: "–ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã —Å–æ–ª—è–Ω—ã–µ —à–∞—Ö—Ç—ã?", options: ["–°–æ–ª–µ–¥–∞—Ä","–¢–æ—Ä–µ–∑","–°–Ω–µ–∂–Ω–æ–µ","–î–æ–∫—É—á–∞–µ–≤—Å–∫"], answer: 0 },
        { q: "–ö–∞–∫–æ–µ –º–æ—Ä–µ –±–ª–∏–∂–µ –≤—Å–µ–≥–æ?", options: ["–ê–∑–æ–≤—Å–∫–æ–µ","–ß—ë—Ä–Ω–æ–µ","–ë–∞–ª—Ç–∏–π—Å–∫–æ–µ","–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–µ"], answer: 0 },
        { q: "–ö—Ä—É–ø–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥?", options: ["–ì–æ—Ä–ª–æ–≤–∫–∞","–ö—Ä–∞–º–∞—Ç–æ—Ä—Å–∫","–°–ª–∞–≤—è–Ω—Å–∫","–õ–∏–º–∞–Ω"], answer: 0 },
        { q: "–ö–ª–∏–º–∞—Ç —Ä–µ–≥–∏–æ–Ω–∞?", options: ["–£–º–µ—Ä–µ–Ω–Ω–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π","–¢—Ä–æ–ø–∏—á–µ—Å–∫–∏–π","–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏–π","–ú—É—Å—Å–æ–Ω–Ω—ã–π"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω–æ–µ –ø–æ–ª–µ–∑–Ω–æ–µ –∏—Å–∫–æ–ø–∞–µ–º–æ–µ?", options: ["–£–≥–æ–ª—å","–ù–µ—Ñ—Ç—å","–ó–æ–ª–æ—Ç–æ","–£—Ä–∞–Ω"], answer: 0 }
      ],

      "–õ—É–≥–∞–Ω—Å–∫–∞—è –ù–∞—Ä–æ–¥–Ω–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞": [
        { q: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä –õ–ù–†?", options: ["–õ—É–≥–∞–Ω—Å–∫","–†–æ–≤–µ–Ω—å–∫–∏","–ê–ª—á–µ–≤—Å–∫","–°—Ç–∞—Ö–∞–Ω–æ–≤"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω–∞—è —Ä–µ–∫–∞ –õ–ù–†?", options: ["–°–µ–≤–µ—Ä—Å–∫–∏–π –î–æ–Ω–µ—Ü","–î–Ω–µ–ø—Ä","–ü—Ä—É—Ç","–¢–∏—Å–∞"], answer: 0 },
        { q: "–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å —Ä–µ–≥–∏–æ–Ω–∞?", options: ["–ú–∞—à–∏–Ω–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ","–¢—É—Ä–∏–∑–º","–õ–µ—Å–Ω–∞—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å","–†—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ"], answer: 0 },
        { q: "–ì–æ—Ä–æ–¥ –º–µ—Ç–∞–ª–ª—É—Ä–≥–∏–∏?", options: ["–ê–ª—á–µ–≤—Å–∫","–õ—É–≥–∞–Ω—Å–∫","–°—Ç–∞—Ö–∞–Ω–æ–≤","–†—É–±–µ–∂–Ω–æ–µ"], answer: 0 },
        { q: "–ö–ª–∏–º–∞—Ç —Ä–µ–≥–∏–æ–Ω–∞?", options: ["–£–º–µ—Ä–µ–Ω–Ω–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π","–°—É–±—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–π","–ú–æ—Ä—Å–∫–æ–π","–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏–π"], answer: 0 },
        { q: "–ì–æ—Ä–æ–¥ —É –≥—Ä–∞–Ω–∏—Ü—ã —Å –†–§?", options: ["–ö—Ä–∞—Å–Ω–æ–¥–æ–Ω","–õ–∏—Å–∏—á–∞–Ω—Å–∫","–†—É–±–µ–∂–Ω–æ–µ","–°–µ–≤–µ—Ä–æ–¥–æ–Ω–µ—Ü–∫"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω–æ–µ –ø–æ–ª–µ–∑–Ω–æ–µ –∏—Å–∫–æ–ø–∞–µ–º–æ–µ?", options: ["–£–≥–æ–ª—å","–ù–µ—Ñ—Ç—å","–ì–∞–∑","–ó–æ–ª–æ—Ç–æ"], answer: 0 },
        { q: "–° –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–æ–π –≥—Ä–∞–Ω–∏—á–∏—Ç –õ–ù–†?", options: ["–†–æ—Å—Å–∏—è","–ü–æ–ª—å—à–∞","–ë–µ–ª–∞—Ä—É—Å—å","–†—É–º—ã–Ω–∏—è"], answer: 0 },
        { q: "–ú–∞—à–∏–Ω–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥?", options: ["–†—É–±–µ–∂–Ω–æ–µ","–ê–ª—á–µ–≤—Å–∫","–õ—É–≥–∞–Ω—Å–∫","–õ–∏—Å–∏—á–∞–Ω—Å–∫"], answer: 0 },
        { q: "–ü—Ä–µ–æ–±–ª–∞–¥–∞—é—â–∏–π –ª–∞–Ω–¥—à–∞—Ñ—Ç?", options: ["–°—Ç–µ–ø—å","–ì–æ—Ä—ã","–¢–∞–π–≥–∞","–ü—É—Å—Ç—ã–Ω—è"], answer: 0 }
      ],

      "–•–µ—Ä—Å–æ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": [
        { q: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä?", options: ["–•–µ—Ä—Å–æ–Ω","–ù–æ–≤–∞—è –ö–∞—Ö–æ–≤–∫–∞","–ì–µ–Ω–∏—á–µ—Å–∫","–°–∫–∞–¥–æ–≤—Å–∫"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω–∞—è —Ä–µ–∫–∞ –æ–±–ª–∞—Å—Ç–∏?", options: ["–î–Ω–µ–ø—Ä","–Æ–∂–Ω—ã–π –ë—É–≥","–ò–Ω–≥—É–ª–µ—Ü","–î–æ–Ω"], answer: 0 },
        { q: "–í—ã—Ö–æ–¥ –∫ –∫–∞–∫–æ–º—É –º–æ—Ä—é?", options: ["–ß—ë—Ä–Ω–æ–µ","–ê–∑–æ–≤—Å–∫–æ–µ","–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–µ","–ë–∞–ª—Ç–∏–π—Å–∫–æ–µ"], answer: 0 },
        { q: "–û—Å–Ω–æ–≤–Ω–∞—è –æ—Ç—Ä–∞—Å–ª—å —Ö–æ–∑—è–π—Å—Ç–≤–∞?", options: ["–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ","–£–≥–æ–ª—å–Ω–∞—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å","–õ–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ","–¢—É—Ä–∏–∑–º"], answer: 0 },
        { q: "–ö–∞–∫–æ–π –≤–∞–∂–Ω—ã–π –∫–∞–Ω–∞–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ä–µ–≥–∏–æ–Ω?", options: ["–°–µ–≤–µ—Ä–æ-–ö—Ä—ã–º—Å–∫–∏–π –∫–∞–Ω–∞–ª","–î–Ω–µ–ø—Ä–æ–≤—Å–∫–∏–π –∫–∞–Ω–∞–ª","–í–æ–ª–≥–æ-–î–æ–Ω—Å–∫–æ–π","–ö–∞—Ö–æ–≤—Å–∫–∏–π"], answer: 0 },
        { q: "–ö–ª–∏–º–∞—Ç –æ–±–ª–∞—Å—Ç–∏?", options: ["–°—Ç–µ–ø–Ω–æ–π","–£–º–µ—Ä–µ–Ω–Ω—ã–π","–ì–æ—Ä–Ω—ã–π","–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏–π"], answer: 0 },
        { q: "–ü–æ—Ä—Ç–æ–≤—ã–π –≥–æ—Ä–æ–¥ –æ–±–ª–∞—Å—Ç–∏?", options: ["–•–µ—Ä—Å–æ–Ω","–°–∫–∞–¥–æ–≤—Å–∫","–ò–∑–º–∞–∏–ª","–ë–µ—Ä–¥—è–Ω—Å–∫"], answer: 0 },
        { q: "–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—É–ª—å—Ç—É—Ä—ã?", options: ["–û–≤–æ—â–∏ –∏ –∑–µ—Ä–Ω–æ–≤—ã–µ","–†–∏—Å","–í–∏–Ω–æ–≥—Ä–∞–¥","–•–º–µ–ª—å"], answer: 0 },
        { q: "–ü—Ä–∏—Ä–æ–¥–Ω–∞—è –∑–æ–Ω–∞ –æ–±–ª–∞—Å—Ç–∏?", options: ["–°—Ç–µ–ø—å","–¢–∞–π–≥–∞","–¢—É–Ω–¥—Ä–∞","–ì–æ—Ä—ã"], answer: 0 },
        { q: "–ö–∞–∫–∞—è –ö–∞—Ö–æ–≤–∫–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ –ì–≠–°?", options: ["–ù–æ–≤–∞—è –ö–∞—Ö–æ–≤–∫–∞","–°—Ç–∞—Ä–∞—è –ö–∞—Ö–æ–≤–∫–∞","–ö–∞—Ö–æ–≤–∫–∞-2","–ö–∞—Ö–æ–≤–∫–∞-3"], answer: 0 }
      ],

      "–ó–∞–ø–æ—Ä–æ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å": [
        { q: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä?", options: ["–ó–∞–ø–æ—Ä–æ–∂—å–µ","–ú–µ–ª–∏—Ç–æ–ø–æ–ª—å","–ë–µ—Ä–¥—è–Ω—Å–∫","–≠–Ω–µ—Ä–≥–æ–¥–∞—Ä"], answer: 0 },
        { q: "–ö–∞–∫–∞—è —Ä–µ–∫–∞ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –æ–±–ª–∞—Å—Ç—å?", options: ["–î–Ω–µ–ø—Ä","–Æ–∂–Ω—ã–π –ë—É–≥","–ò–Ω–≥—É–ª–µ—Ü","–î–æ–Ω"], answer: 0 },
        { q: "–ò–∑–≤–µ—Å—Ç–Ω–∞—è –ì–≠–° –≤ —Ä–µ–≥–∏–æ–Ω–µ?", options: ["–î–Ω–µ–ø—Ä–æ–ì–≠–°","–ö–∞—Ö–æ–≤—Å–∫–∞—è –ì–≠–°","–ó–∞–ø–æ—Ä–æ–∂—Å–∫–∞—è –ì–≠–°","–°–∞–º—Ä–∞–¥"], answer: 0 },
        { q: "–ö—Ä—É–ø–Ω—ã–π –æ—Å—Ç—Ä–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä?", options: ["–•–æ—Ä—Ç–∏—Ü–∞","–ë—ã–ª–æ","–ù–µ—Ç","–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"], answer: 0 },
        { q: "–ö–ª–∏–º–∞—Ç —Ä–µ–≥–∏–æ–Ω–∞?", options: ["–°—Ç–µ–ø–Ω–æ–π","–ì–æ—Ä–Ω—ã–π","–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏–π","–£–º–µ—Ä–µ–Ω–Ω–æ-–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª—å–Ω—ã–π"], answer: 0 },
        { q: "–ö—É—Ä–æ—Ä—Ç–Ω—ã–π –≥–æ—Ä–æ–¥ –æ–±–ª–∞—Å—Ç–∏?", options: ["–ë–µ—Ä–¥—è–Ω—Å–∫","–Ø–ª—Ç–∞","–°–∫–∞–¥–æ–≤—Å–∫","–ö–µ—Ä—á—å"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω–∞—è –æ—Ç—Ä–∞—Å–ª—å —ç–∫–æ–Ω–æ–º–∏–∫–∏?", options: ["–ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è","–†—ã–±–æ–ª–æ–≤—Å—Ç–≤–æ","–¢—É—Ä–∏–∑–º","–õ–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ"], answer: 0 },
        { q: "–ö—Ä—É–ø–Ω—ã–π –ø–æ—Ä—Ç –≤ —Ä–µ–≥–∏–æ–Ω–µ?", options: ["–ë–µ—Ä–¥—è–Ω—Å–∫","–ú–∞—Ä–∏—É–ø–æ–ª—å","–û–¥–µ—Å—Å–∞","–ù–∏–∫–æ–ª–∞–µ–≤"], answer: 0 },
        { q: "–ò–∑–≤–µ—Å—Ç–Ω–∞—è –ª–∏–º–∞–Ω-–ª–∞–≥—É–Ω–∞?", options: ["–ú–æ–ª–æ—á–Ω—ã–π –ª–∏–º–∞–Ω","–°–∏–≤–∞—à","–ö—É—è–ª—å–Ω–∏–∫","–î–Ω–µ–ø—Ä–æ–≤—Å–∫–∏–π –ª–∏–º–∞–Ω"], answer: 0 },
        { q: "–ö–∞–∫–æ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥?", options: ["–ó–∞–ø–æ—Ä–æ–∂—å–µ","–û—Ä–µ—Ö–æ–≤","–ü–æ–ª–æ–≥–∏","–¢–æ–∫–º–∞–∫"], answer: 0 }
      ],

      "–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º": [
        { q: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Ü–µ–Ω—Ç—Ä?", options: ["–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å","–Ø–ª—Ç–∞","–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å","–ö–µ—Ä—á—å"], answer: 0 },
        { q: "–ö–∞–∫–æ–µ –º–æ—Ä–µ –æ–º—ã–≤–∞–µ—Ç –ö—Ä—ã–º?", options: ["–ß—ë—Ä–Ω–æ–µ","–ê–∑–æ–≤—Å–∫–æ–µ","–ë–∞–ª—Ç–∏–π—Å–∫–æ–µ","–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–µ"], answer: 0 },
        { q: "–Æ–∂–Ω—ã–π –±–µ—Ä–µ–≥ –ö—Ä—ã–º–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç –∫–ª–∏–º–∞—Ç–æ–º?", options: ["–°—É–±—Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–º","–ê—Ä–∫—Ç–∏—á–µ—Å–∫–∏–º","–ü—É—Å—Ç—ã–Ω–Ω—ã–º","–¢–∞–π–≥–æ–≤—ã–º"], answer: 0 },
        { q: "–ó–Ω–∞–º–µ–Ω–∏—Ç—ã–π –¥–≤–æ—Ä–µ—Ü-—Å–∏–º–≤–æ–ª?", options: ["–õ–∞—Å—Ç–æ—á–∫–∏–Ω–æ –≥–Ω–µ–∑–¥–æ","–ü–µ—Ç–µ—Ä–≥–æ—Ñ","–í–µ—Ä—Å–∞–ª—å","–¢–∞–¥–∂-–ú–∞—Ö–∞–ª"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω—ã–π –ø–æ—Ä—Ç (–≥–µ—Ä–æ–π-–≥–æ—Ä–æ–¥)?", options: ["–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å","–Ø–ª—Ç–∞","–ö–µ—Ä—á—å","–§–µ–æ–¥–æ—Å–∏—è"], answer: 0 },
        { q: "–ò–∑–≤–µ—Å—Ç–Ω—ã–π –∫—É—Ä–æ—Ä—Ç–Ω—ã–π –≥–æ—Ä–æ–¥?", options: ["–Ø–ª—Ç–∞","–ó–∞—Ç–æ–∫–∞","–ö–∏—Ä–∏–ª–ª–æ–≤–∫–∞","–ë–µ—Ä–¥—è–Ω—Å–∫"], answer: 0 },
        { q: "–ö–∞–∫–æ–µ –æ–∑–µ—Ä–æ –∏–∑–≤–µ—Å—Ç–Ω–æ (–ª–∞–≥—É–Ω–∞)?", options: ["–°–∏–≤–∞—à","–ö—É—è–ª—å–Ω–∏–∫","–ú–æ–ª–æ—á–Ω—ã–π –ª–∏–º–∞–Ω","–î–Ω–µ—Å—Ç—Ä–æ–≤—Å–∫–æ–µ"], answer: 0 },
        { q: "–ì–æ—Ä–∞-—Å–∏–º–≤–æ–ª —é–∂–Ω–æ–≥–æ –±–µ—Ä–µ–≥–∞?", options: ["–ê–π-–ü–µ—Ç—Ä–∏","–ì–æ–≤–µ—Ä–ª–∞","–≠–ª—å–±—Ä—É—Å","–ö–∞–∑–±–µ–∫"], answer: 0 },
        { q: "–ö—Ä—É–ø–Ω—ã–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø–∞–º—è—Ç–Ω–∏–∫ –≤ –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª–µ?", options: ["–•–µ—Ä—Å–æ–Ω–µ—Å","–ö–∞—á–∞","–ì—Ä–∞–¥","–ö—Ä–µ–º–ª—å"], answer: 0 },
        { q: "–ì–ª–∞–≤–Ω–∞—è –æ—Ç—Ä–∞—Å–ª—å —ç–∫–æ–Ω–æ–º–∏–∫–∏ —Ä–µ–≥–∏–æ–Ω–∞?", options: ["–¢—É—Ä–∏–∑–º","–ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è","–ù–µ—Ñ—Ç—å","–õ–µ—Å–Ω–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ"], answer: 0 }
      ]
    };

    /***** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è *****/
    const POINTS = 10;
    const AUTO_NEXT_DELAY = 1500; // ms (1.5 s)
    let selectedRegion = null;
    let player = "";
    let current = 0, score = 0;
    let startTime = 0, endTime = 0;
    let autoNextTimer = null;
    let autoNextInterval = null;
    let currentSessionQuestions = []; // –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –∫–≤–∏–∑–∞

    /* Elements */
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const leadersScreen = document.getElementById('leaders-screen');

    const areasGrid = document.getElementById('areasGrid');
    const startBtn = document.getElementById('start-btn');
    const viewLeadersBtn = document.getElementById('view-leaders');
    const viewLeadersBtn2 = document.getElementById('view-leaders-2');
    const playAgainBtn = document.getElementById('play-again');
    const backHomeBtn = document.getElementById('back-home');
    const refreshLeadersBtn = document.getElementById('refresh-leaders');

    const progressText = document.getElementById('progress-text');
    const regionLabel = document.getElementById('region-label');
    const qText = document.getElementById('question-text');
    const optionsBox = document.getElementById('options');
    const autoNextProgress = document.getElementById('auto-next-progress');

    const finalScoreEl = document.getElementById('final-score');
    const timeResultEl = document.getElementById('time-result');
    const resultTextEl = document.getElementById('result-text');
    const savingTextEl = document.getElementById('saving-text');
    const leadersBody = document.getElementById('leaders-body');
    const leadersRegionName = document.getElementById('leaders-region-name');

    /***** –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è *****/
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (–∞–ª–≥–æ—Ä–∏—Ç–º –§–∏—à–µ—Ä–∞-–ô–µ–π—Ç—Å–∞)
    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –∫–≤–∏–∑–∞
    function prepareQuestionsForSession(originalQuestions) {
      // –°–æ–∑–¥–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é –≤–æ–ø—Ä–æ—Å–æ–≤
      const questionsCopy = JSON.parse(JSON.stringify(originalQuestions));
      
      // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤
      const shuffledQuestions = shuffleArray(questionsCopy);
      
      // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
      const processedQuestions = shuffledQuestions.map(question => {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–æ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è
        const correctAnswer = question.options[question.answer];
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
        const shuffledOptions = shuffleArray([...question.options]);
        
        // –ù–∞—Ö–æ–¥–∏–º –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        const newAnswerIndex = shuffledOptions.indexOf(correctAnswer);
        
        return {
          q: question.q,
          options: shuffledOptions,
          answer: newAnswerIndex
        };
      });
      
      return processedQuestions;
    }

    /***** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ *****/
    const regions = Object.keys(ORIGINAL_QUESTIONS_BY_REGION);

    function buildAreasGrid(){
      areasGrid.innerHTML = "";
      regions.forEach((r, idx) => {
        const d = document.createElement('div');
        d.className = 'area-card';
        d.dataset.region = r;
        d.innerHTML = `<strong style="display:block;margin-bottom:6px;">${r}</strong><small style="opacity:.7">–í–æ–ø—Ä–æ—Å–æ–≤: ${ORIGINAL_QUESTIONS_BY_REGION[r].length}</small>`;
        d.onclick = () => {
          // —Å–Ω—è—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É –≤—Å–µ—Ö
          document.querySelectorAll('.area-card').forEach(el => el.classList.remove('active'));
          d.classList.add('active');
          selectedRegion = r;
          regionLabel.textContent = r;
          document.getElementById('page-title').textContent = `–ö–≤–∏–∑: ${r}`;
        };
        areasGrid.appendChild(d);
      });
    }
    buildAreasGrid();

    /***** Theme toggle —Å Font Awesome –∏ motion blur *****/
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const savedTheme = localStorage.getItem('theme') || 'light';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–µ–º—É –∏ –∏–∫–æ–Ω–∫—É
    if(savedTheme === 'dark') {
      document.body.classList.add('dark');
      themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
    } else {
      themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
    }

    themeToggle.onclick = () => {
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
      themeToggle.classList.add('rotating');
      
      setTimeout(() => {
        const isDark = document.body.classList.toggle('dark');
        
        // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
        if(isDark) {
          themeIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
        } else {
          themeIcon.innerHTML = '<i class="fa-solid fa-sun"></i>';
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–º—É
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        setTimeout(() => {
          themeToggle.classList.remove('rotating');
        }, 100);
      }, 400); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    };

    /***** Quiz flow *****/
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    startBtn.onclick = () => {
      player = document.getElementById('player').value.trim();
      if(!player) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');
      if(!selectedRegion) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–π–¥—ë—Ç–µ –∫–≤–∏–∑.');
      
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –∫–≤–∏–∑–∞
      const originalQuestions = ORIGINAL_QUESTIONS_BY_REGION[selectedRegion];
      currentSessionQuestions = prepareQuestionsForSession(originalQuestions);
      
      // init
      current = 0; score = 0; startTime = Date.now();
      // switch
      hide(startScreen); hide(resultScreen); hide(leadersScreen);
      show(quizScreen);
      renderQuestion();
    };

    function renderQuestion(){
      const q = currentSessionQuestions[current];
      qText.textContent = q.q;
      progressText.textContent = `–í–æ–ø—Ä–æ—Å ${current+1} –∏–∑ ${currentSessionQuestions.length}`;
      regionLabel.textContent = selectedRegion;
      optionsBox.innerHTML = '';
      q.options.forEach((opt, i) => {
        const el = document.createElement('div');
        el.className = 'option';
        el.textContent = opt;
        el.tabIndex = 0;
        el.onclick = ()=> selectAnswer(i, el);
        el.onkeydown = (e) => { if(e.key === 'Enter') selectAnswer(i, el); };
        optionsBox.appendChild(el);
      });

      // —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–∞
      resetAutoNext();
    }

    function selectAnswer(idx, elClicked){
      if(autoNextTimer) return; // —É–∂–µ –≤—ã–±—Ä–∞–Ω ‚Äî –∏–≥–Ω–æ—Ä
      const q = currentSessionQuestions[current];

      // –ø–æ–¥—Å–≤–µ—Ç–∫–∞
      Array.from(optionsBox.children).forEach((optEl, i) => {
        if(i === q.answer) optEl.classList.add('correct');
        if(i === idx && idx !== q.answer) optEl.classList.add('wrong');
      });

      if(idx === q.answer) score += POINTS;

      startAutoNext();
    }

    // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
    document.getElementById('skip-btn').onclick = () => {
      // –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ–º, –ø—Ä–æ—Å—Ç–æ –∏–¥—ë–º –¥–∞–ª—å—à–µ
      if(autoNextTimer) return; // –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–¥—ë—Ç, –∂–¥–µ–º
      startAutoNext(true);
    };

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å
    document.getElementById('end-btn').onclick = () => {
      finishQuiz();
    };

    function startAutoNext(forceSkip=false){
      // forceSkip: –∫–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –Ω–æ –Ω–µ –º–µ–Ω—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
      let progress = 0;
      const steps = 1500 / 30; // 30ms tick
      autoNextTimer = true;
      autoNextProgress.style.width = '0%';
      autoNextInterval = setInterval(()=>{
        progress += 100/steps;
        autoNextProgress.style.width = progress + '%';
        if(progress >= 100){
          clearInterval(autoNextInterval);
          autoNextInterval = null;
          autoNextTimer = null;
          autoNextProgress.style.width = '0%';
          nextOrFinish();
        }
      }, 30);
    }

    function resetAutoNext(){
      if(autoNextInterval){ clearInterval(autoNextInterval); autoNextInterval = null; autoNextTimer = null; }
      autoNextProgress.style.width = '0%';
    }

    function nextOrFinish(){
      if(current < currentSessionQuestions.length - 1){
        current++;
        renderQuestion();
      } else {
        finishQuiz();
      }
    }

    function finishQuiz(){
      endTime = Date.now();
      const timeSpent = Math.floor((endTime - startTime) / 1000);

      hide(quizScreen);
      show(resultScreen);

      const totalPoints = currentSessionQuestions.length * POINTS;
      finalScoreEl.textContent = `${score} / ${totalPoints}`;
      timeResultEl.textContent = `–í—Ä–µ–º—è: ${timeSpent} —Å–µ–∫`;

      const pct = Math.round((score / totalPoints) * 100);
      if(pct >= 80) resultTextEl.textContent = "–û—Ç–ª–∏—á–Ω–æ! üéâ";
      else if(pct >= 60) resultTextEl.textContent = "–•–æ—Ä–æ—à–æ! üëç";
      else resultTextEl.textContent = "–ú–æ–∂–Ω–æ –ª—É—á—à–µ! üí™";

      // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      savingTextEl.textContent = "–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç...";
      autoSaveScore(timeSpent);
    }

    playAgainBtn.onclick = () => {
      // –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç
      hide(resultScreen); hide(leadersScreen); show(startScreen);
      // —Å–±—Ä–æ—Å –≤–∏–∑—É–∞–ª–∞ –≤—ã–±–æ—Ä–∞
      document.querySelectorAll('.area-card').forEach(el => el.classList.remove('active'));
      selectedRegion = null;
      regionLabel.textContent = '';
      document.getElementById('page-title').textContent = '–ö–≤–∏–∑ –ø–æ –æ–±–ª–∞—Å—Ç—è–º';
      // –æ—á–∏—â–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
      currentSessionQuestions = [];
    };

    /***** Supabase: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ + –∑–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–æ–≤ (—Ñ–∏–ª—å—Ç—Ä –ø–æ region) *****/
    async function autoSaveScore(timeSeconds){
      try{
        const { data, error } = await supabase
          .from('leaderboard')
          .insert([
            {
              name: player,
              score: score,
              total_questions: currentSessionQuestions.length,
              time_seconds: timeSeconds,
              region: selectedRegion,
              created_at: new Date().toISOString()
            }
          ]);
        if(error) throw error;
        savingTextEl.textContent = "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥!";
      }catch(err){
        console.error('Save error', err);
        savingTextEl.textContent = "‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è";
      }
    }

    async function getLeadersForRegion(region){
      try{
        const { data, error } = await supabase
          .from('leaderboard')
          .select('*')
          .eq('region', region)
          .order('score', { ascending: false })
          .order('time_seconds', { ascending: true })
          .limit(20);

        if(error) throw error;
        return data || [];
      }catch(err){
        console.error('Load leaders error', err);
        return [];
      }
    }

    async function showLeaders(){
      // Determine region to show: if quiz in progress, use selectedRegion; else ask user to choose
      if(!selectedRegion){
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏–¥–µ—Ä–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.');
        return;
      }
      hide(startScreen); hide(quizScreen); hide(resultScreen);
      show(leadersScreen);
      leadersRegionName.textContent = selectedRegion;
      leadersBody.innerHTML = '<tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
      const arr = await getLeadersForRegion(selectedRegion);
      if(!arr.length){
        leadersBody.innerHTML = '<tr><td colspan="4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
        return;
      }
      leadersBody.innerHTML = '';
      arr.forEach((row, i) => {
        const tr = document.createElement('tr');
        const pos = i+1;
        tr.innerHTML = `<td>${pos}</td><td>${escapeHtml(row.name)}</td><td>${row.score}</td><td>${row.time_seconds} —Å–µ–∫</td>`;
        leadersBody.appendChild(tr);
      });
    }

    viewLeadersBtn.onclick = showLeaders;
    viewLeadersBtn2.onclick = showLeaders;
    backHomeBtn.onclick = () => { hide(leadersScreen); show(startScreen); };
    refreshLeadersBtn.onclick = showLeaders;

    /***** Utilities *****/
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

    /***** Keyboard shortcuts accessibility *****/
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){ // –≤—ã–π—Ç–∏ –≤ —Å—Ç–∞—Ä—Ç
        hide(quizScreen); hide(resultScreen); hide(leadersScreen); show(startScreen);
      }
    });

    /***** On load: if theme saved, restore; build areas (already done)  *****/
    // buildAreasGrid(); // already built earlier
  </script>
  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ localStorage (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ autoSaveScore)
// –ü–†–û–°–¢–ê–Ø –∏ –Ω–∞–¥–µ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
// –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
async function saveToLocalStorage(score, totalQuestions, timeSeconds, region, playerName) {
    try {
        console.log('üîÑ Saving to localStorage:', { 
            score, 
            totalQuestions, // –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ (10), –∞ –Ω–µ –±–∞–ª–ª–æ–≤ (100)
            timeSeconds, 
            region, 
            playerName 
        });
        
        // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º: totalQuestions –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ–ø—Ä–æ—Å–æ–≤, –∞ –Ω–µ –æ–±—â–∏—Ö –±–∞–ª–ª–æ–≤
        const numberOfQuestions = totalQuestions; // totalQuestions —É–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
        
        const results = {
            score: score,
            totalQuestions: numberOfQuestions, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ (10)
            percentage: Math.round((score / (numberOfQuestions * 10)) * 100), // score=100, questions=10 ‚Üí 100%
            timeSeconds: timeSeconds,
            region: region,
            playerName: playerName,
            completedAt: new Date().toISOString()
        };
        
        localStorage.setItem('quizResults', JSON.stringify(results));
        sessionStorage.setItem('quizResultsUpdated', 'true');
        
        console.log('‚úÖ Saved results:', results);
        return true;
    } catch (err) {
        console.error('‚ùå Error saving to localStorage:', err);
        return false;
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è finishQuiz - –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
function finishQuiz() {
    endTime = Date.now();
    const timeSpent = Math.floor((endTime - startTime) / 1000);

    hide(quizScreen);
    show(resultScreen);

    const totalPoints = currentSessionQuestions.length * POINTS;
    finalScoreEl.textContent = `${score} / ${totalPoints}`;
    timeResultEl.textContent = `–í—Ä–µ–º—è: ${timeSpent} —Å–µ–∫`;

    // –ü–†–ê–í–ò–õ–¨–ù–´–ô —Ä–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ - —É–±–∏—Ä–∞–µ–º —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 10
    const pct = Math.round((score / totalPoints) * 100);
    if(pct >= 80) resultTextEl.textContent = "–û—Ç–ª–∏—á–Ω–æ! üéâ";
    else if(pct >= 60) resultTextEl.textContent = "–•–æ—Ä–æ—à–æ! üëç";
    else resultTextEl.textContent = "–ú–æ–∂–Ω–æ –ª—É—á—à–µ! üí™";

    // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    savingTextEl.textContent = "–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç...";
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –≤ Supabase, –∏ –≤ localStorage
    Promise.all([
        autoSaveScore(timeSpent),
        saveToLocalStorage(score, totalPoints, timeSpent, selectedRegion)
    ]).then(() => {
        savingTextEl.textContent = "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!";
    }).catch(err => {
        console.error('Save error', err);
        savingTextEl.textContent = "‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è";
    });
}
</script>
</body>
</html>