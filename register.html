<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация</title>
    <style>
        /* Используем ваши стили */
        :root{
          --bg-light: #f4f4f9;
          --bg-dark: #0f1720;
          --text-light: #111827;
          --text-dark: #f1f5f9;
          --card-light: #ffffff;
          --card-dark: #111318;
          --accent: #0d6efd;
          --accent-2: #66a3ff;
          --muted-light: #6c757d;
          --muted-dark: #9aa4b2;
          --success: #16a34a;
          --danger: #dc2626;
          --transition-fast: 0.25s;
          --transition-med: 0.4s;
        }

        html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;}
        body{
          display:flex;align-items:center;justify-content:center;
          background:var(--bg-light);
          color:var(--text-light);
          transition: background var(--transition-med), color var(--transition-med);
          min-height:100vh;
          padding:20px;
        }
        body.dark{ background:var(--bg-dark); color:var(--text-dark); }

        .card{
          width:100%; max-width:400px;
          background:var(--card-light);
          border-radius:14px;
          padding:22px;
          box-shadow:0 10px 30px rgba(2,6,23,0.08);
          position:relative;
          transition: background var(--transition-med), box-shadow var(--transition-med);
        }
        body.dark .card{ background:var(--card-dark); box-shadow:0 6px 18px rgba(0,0,0,0.6); }

        h1{ margin:0 0 6px 0; font-size:22px; }
        p.lead{ margin:0 0 18px 0; color: #6b7280; }
        body.dark p.lead{ color: var(--muted-dark); }

        .form-group{ margin-bottom:16px; }
        label{ display:block; margin-bottom:6px; font-size:14px; font-weight:500; }
        
        input[type="email"], input[type="password"], input[type="text"]{
          width:100%; padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb;
          font-size:15px; outline: none; transition: box-shadow .15s;
          box-sizing: border-box;
        }
        input:focus{ 
          box-shadow:0 6px 20px rgba(13,110,253,0.08); 
          border-color:var(--accent); 
        }

        button.btn{
          background:var(--accent); color:#fff; padding:10px 14px;border-radius:10px;border:none; cursor:pointer;
          font-weight:600; transition: transform .12s, background .2s;
          width:100%; margin-top:10px;
        }
        button.btn:hover{ transform: translateY(-2px); background:var(--accent-2); }
        button.btn:disabled { background: var(--muted-light); cursor: not-allowed; transform: none; }

        .message{
          padding:10px 12px; border-radius:10px; margin-bottom:16px;
          font-size:14px; display:none;
        }
        .message.success{ background:#dcfce7; border:1px solid rgba(16,185,129,0.18); color:#064e3b; }
        .message.error{ background:#ffe4e6; border:1px solid rgba(220,38,38,0.12); color:#6b021f; }

        .password-requirements {
            font-size: 12px;
            margin-top: 5px;
            color: var(--muted-light);
        }

        .requirement {
            display: flex;
            align-items: center;
            margin-bottom: 2px;
        }

        .requirement.valid { color: var(--success); }
        .requirement.invalid { color: var(--danger); }

        .links{ text-align:center; margin-top:16px; font-size:14px; }
        .links a{ color:var(--accent); text-decoration:none; }
        .links a:hover{ text-decoration:underline; }

        footer{ margin-top:14px; font-size:13px; color: #6b7280; text-align:center; }
        body.dark footer{ color:var(--muted-dark); }
    </style>
</head>
<body>
    <div class="card">
        <h1>Регистрация</h1>
        <p class="lead">Создайте новую учетную запись</p>
        
        <div id="message" class="message"></div>
        
        <form id="registerForm">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="your@email.com" required>
            </div>
            
            <div class="form-group">
                <label for="password">Пароль</label>
                <input type="password" id="password" name="password" placeholder="Придумайте пароль" required>
                <div class="password-requirements" id="passwordRequirements">
                    <div class="requirement invalid" id="reqLength">✓ Минимум 8 символов</div>
                    <div class="requirement invalid" id="reqUpperCase">✓ Заглавная буква</div>
                    <div class="requirement invalid" id="reqLowerCase">✓ Строчная буква</div>
                    <div class="requirement invalid" id="reqNumber">✓ Цифра</div>
                    <div class="requirement invalid" id="reqSpecial">✓ Специальный символ</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="confirmPassword">Подтверждение пароля</label>
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Повторите пароль" required>
                <div class="password-requirements">
                    <div class="requirement invalid" id="reqMatch">✓ Пароли совпадают</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="fullName">Полное имя (опционально)</label>
                <input type="text" id="fullName" name="fullName" placeholder="Иван Иванов">
            </div>
            
            <button type="submit" class="btn" id="registerBtn">Зарегистрироваться</button>
        </form>
        
        <div class="links">
            Уже есть аккаунт? <a href="login.html">Войдите</a>
        </div>
        
        <footer>
            &copy; 2023 Ваша компания. Все права защищены.
        </footer>
    </div>

    <script>
        class RegistrationApp {
            constructor() {
                this.registrationManager = new RegistrationManager();
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupPasswordValidation();
            }

            setupEventListeners() {
                document.getElementById('registerForm').addEventListener('submit', (e) => {
                    this.handleRegistration(e);
                });
            }

            setupPasswordValidation() {
                const passwordInput = document.getElementById('password');
                const confirmInput = document.getElementById('confirmPassword');

                passwordInput.addEventListener('input', () => {
                    this.validatePassword();
                });

                confirmInput.addEventListener('input', () => {
                    this.validatePasswordMatch();
                });
            }

            validatePassword() {
                const password = document.getElementById('password').value;
                const validation = this.registrationManager.validatePassword(password);

                // Обновляем отображение требований
                document.getElementById('reqLength').className = 
                    `requirement ${validation.requirements.minLength ? 'valid' : 'invalid'}`;
                document.getElementById('reqUpperCase').className = 
                    `requirement ${validation.requirements.hasUpperCase ? 'valid' : 'invalid'}`;
                document.getElementById('reqLowerCase').className = 
                    `requirement ${validation.requirements.hasLowerCase ? 'valid' : 'invalid'}`;
                document.getElementById('reqNumber').className = 
                    `requirement ${validation.requirements.hasNumbers ? 'valid' : 'invalid'}`;
                document.getElementById('reqSpecial').className = 
                    `requirement ${validation.requirements.hasSpecialChar ? 'valid' : 'invalid'}`;

                return validation.isValid;
            }

            validatePasswordMatch() {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const isValid = password === confirmPassword && password.length > 0;

                document.getElementById('reqMatch').className = 
                    `requirement ${isValid ? 'valid' : 'invalid'}`;

                return isValid;
            }

            async handleRegistration(e) {
                e.preventDefault();

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const fullName = document.getElementById('fullName').value;

                // Валидация
                if (!this.registrationManager.validateEmail(email)) {
                    this.showMessage('Пожалуйста, введите корректный email', 'error');
                    return;
                }

                if (!this.validatePassword()) {
                    this.showMessage('Пароль не соответствует требованиям безопасности', 'error');
                    return;
                }

                if (!this.validatePasswordMatch()) {
                    this.showMessage('Пароли не совпадают', 'error');
                    return;
                }

                // Подготовка данных
                const userData = {};
                if (fullName) userData.full_name = fullName;

                // Регистрация
                this.setLoading(true);

                const result = await this.registrationManager.registerUser(email, password, userData);

                if (result.success) {
                    this.showMessage('Регистрация успешна! Перенаправление на страницу входа...', 'success');
                    
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    this.showMessage(result.error, 'error');
                }

                this.setLoading(false);
            }

            showMessage(text, type) {
                const messageDiv = document.getElementById('message');
                messageDiv.textContent = text;
                messageDiv.className = `message ${type}`;
                messageDiv.style.display = 'block';

                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }

            setLoading(loading) {
                const btn = document.getElementById('registerBtn');
                if (loading) {
                    btn.textContent = 'Регистрация...';
                    btn.disabled = true;
                } else {
                    btn.textContent = 'Зарегистрироваться';
                    btn.disabled = false;
                }
            }
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            new RegistrationApp();
        });
    </script>
</body>
</html>
